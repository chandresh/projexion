<div id="content">
  <p class="success"><span ><%= flash[:notice] %></span></p>

  <h1><%= @project.name %>&nbsp;(Code: <%= @project.code %>)</h1>

  <div id="project" style="float:left; margin-right:2em;">
    <p>
      <%= label_tag(:vision) %><br/>
      <%= @project.vision %>
    </p>

    <p>
      <%= label_tag(ProjectRole.manager.name) %><br/>
      <%= @manager.login %>
    </p>
  </div>

  <div style="float:right;">

  <div style="float:left; margin-right:2em;">
  	<h2>Project Members</h2>
  	
  	<% unless @project.users.empty? %>
  	<ul>
  	<% @project.users.each do |user| %>
  		<li><%= user.login %></li>
  	<% end %>
  	</ul>
  	<% else %>
  	  <p class="info">
        No members.
      </p>	
  	<% end %>
  </div>
  
  <div style="float:left; margin-right:2em;">
    <h2>Upcoming Releases</h2>

    <% unless @releases.empty? %>
    <ul>
    <% for release in @releases %>
      <li>
        <%= release.version_number %>
        <% link_to project_release_path(@project.code, release.id) do %>
            <img src="/images/icons/application_view_detail.png">
        <% end %>
      </li>
    <% end %>
    </ul>
    <%= link_to 'Show all', project_releases_path(@project.code) %>
    <% else %>
      <p class="info">
        No active releases.
      </p>
    <% end %>
  </div>

  <div style="float:left; margin-right:2em;">
    <h2>Sprints</h2>

    <% unless @sprints.empty? %>
    <ul>
    <% for sprint in @sprints %>
        <li>
          <%= sprint.span_date %>
            <% link_to project_sprint_path(@project.code, sprint.id) do %>
                <img src="/images/icons/application_view_detail.png">
            <% end %>
        </li>
    <% end %>
    </ul>
    <%= link_to 'Show all', project_sprints_path(@project.code) %>
    <% else %>
      <p class="info">
        No active sprints.
      </p>
    <% end %>
  </div>
  </div>

  <div style="clear:both"></div>

  <% unless @features.empty? %>
  <div>
    <h2>Product Features</h2>

    <script type="text/javascript">
      $(document).ready(function(){
        var update_list = function(){
            var accepted = $('#accepted-filter').val();
            $.post('<%= list_project_feature_path(@project.code)  %>', {"accepted": accepted}, function(response){
                $('#features').replaceWith(response);
            }, 'html');
        };  

        $('#filter-button').click(update_list);
      });
    </script>

    <div>
        <select id="accepted-filter" name="accepted">
          <option value="all">All</option>
          <option value="true">Accepted</option>
          <option value="false">Not Accepted</option>
        </select>
        <button id="filter-button">Show</button>
    </div>   
    <%= render :partial => "features/list" %>
  </div>
  <% end %>
</div>

<div id="sidebar">
  <ul>
    <li><%= link_to 'Edit Project', edit_project_path(@project.code), :class => 'edit' %></li>
    <li><%= link_to 'Delete Project', project_path(@project.code), :confirm => 'Are you sure?', :method => :delete, :class => 'delete' %></li>
    <li><%= link_to 'Add New Feature', new_project_feature_path(@project.code), :class => 'add' %></li>
    <li><%= link_to 'Book a meeting', new_project_meeting_path(@project.code), :class => 'add' %></li>
    <li><%= link_to 'Releases', project_releases_path(@project.code), :class => 'list' %></li>
    <li><%= link_to 'Sprints', project_sprints_path(@project.code), :class => 'list' %></li>
    <%# TODO: Burndown chart %>
  </ul>
</div>