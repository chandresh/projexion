<% content_for :title do %><%= @project.name %>&nbsp;:&nbsp;<%= @current_account.company.name %><% end %>

<div id="content">
  <p class="success"><span ><%= flash[:notice] %></span></p>

  <div id="left">

    <div id="project-info">
     <h1><%= @project.name %></h1>
      <%= @project.vision %>
    </div>

    <div id="members">
        <h3>Project Members</h3>

        <% unless @project.project_members.empty? %>
        <ul>
        <% @project.project_members.each do |member| %>
            <li><%= link_to member.user.email, user_path(member.user) %>&nbsp;(<%= member.project_role.name%>)</li>
        <% end %>
        </ul>
        <% else %>
          <div class="info">
            No members.
          </div>
        <% end %>
    </div>

    <div id="releases">
        <h3>Upcoming Releases</h3>

        <% unless @releases.empty? %>
        <ul>
        <% for release in @releases %>
          <li>
            <%= release.version_number %>
            <%= link_to project_release_path(@project.code, release.id), :title => view_release_title, :rel => :tipsy do %>
                <img src="/images/icons/application_view_detail.png">
            <% end %>
            <%= link_to burndown_project_release_path(@project.code, release.id), :title => release_burndown_title, :rel => :tipsy do %>
                <img src="/images/icons/chart_line.png">
            <% end %>
          </li>
        <% end %>
        </ul>
        <%= link_to 'Show all', project_releases_path(@project.code) %>
        <% else %>
          <p class="info">
            No active releases.
          </p>
        <% end %>
    </div>

    <div id="sprints">
        <h3>Upcoming Sprints</h3>
    
        <% unless @sprints.empty? %>
        <ul>
        <% for sprint in @sprints %>
            <li>
              <%= sprint.span_date %>
              <%= link_to project_sprint_path(@project.code, sprint.id), :title => view_sprint_title, :rel => :tipsy do %>
                  <img src="/images/icons/application_view_detail.png">
              <% end %>
              <%=link_to burndown_project_sprint_path(@project.code, sprint.id), :title => sprint_burndown_title, :rel => :tipsy do %>
                <img src="/images/icons/chart_line.png">
              <% end %>
              <%= link_to taskboard_project_sprint_path(@project.code, sprint.id), :title => sprint_board_title, :rel => :tipsy do %>
                <img src="/images/icons/table.png">
              <% end %>
            </li>
        <% end %>
        </ul>
        <%= link_to 'Show all', project_sprints_path(@project.code) %>
        <% else %>
          <p class="info">
            No active sprints.
          </p>
        <% end %>
    </div>
  </div>

  <div id="right">
    <h3>Product Features in Current Sprint</h3>

    <table width="100%">
    <% @features.each do |feature| %>
        <%= render 'features', :target => feature %>
    <% end %>
    </table>  
    <span style="float:right"><%= link_to 'Show All', project_features_path(@project.code) %></span>
  </div>

</div>

<div id="sidebar">
  <ul id="menu">
    <%# TODO: Edit and delete only if project manager %>
    <% if can? :manage, @project %>    
    <li><%= link_to 'Edit Project', edit_admin_project_path(@project.code), :class => 'edit' %></li>
    <li><%= link_to 'Delete Project', admin_project_path(@project.code), :confirm => 'Are you sure?', :method => :delete, :class => 'delete' %></li>
    <% end %>
    <li><%= link_to 'Add New Feature', new_project_feature_path(@project.code), :class => 'add' %></li>
    <li><%= link_to 'Add New Release', new_project_release_path(@project.code), :class => 'add' %></li>
    <li><%= link_to 'Add New Sprint', new_project_sprint_path(@project.code), :class => 'add' %></li>
    <li><%= link_to 'Book a meeting', new_project_meeting_path(@project.code), :class => 'add' %></li>
    <li><%= link_to 'Show Features', project_features_path(@project.code), :class => 'list' %></li>
    <li><%= link_to 'Show Releases', project_releases_path(@project.code), :class => 'list' %></li>
    <li><%= link_to 'Show Meetings', project_meetings_path(@project.code), :class => 'list' %></li>
    <li><%= link_to 'Show Sprints', project_sprints_path(@project.code), :class => 'list' %></li>
    <% unless @sprint.nil? %>
    <li><%= link_to 'Current Sprint Taskboard', taskboard_project_sprint_path(@project.code, @sprint), :class => 'taskboard' %></li>
    <li><%= link_to 'Current Sprint Burndown', burndown_project_sprint_path(@project.code, @sprint), :class => 'chart' %></li>
    <% end %>    
  </ul>
</div>